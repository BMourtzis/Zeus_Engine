# Uniform Buffers
We are moving to 3D objects and a model-view-projection matrix.
To not waste memory we are going to use resource descriptor and a uniform buffer, because the camera is not going to move between frames.

A descriptor is a way for shaders to freely access resoucres, like buffer and images. We are going to load the data in a buffer and have the vertex shader access that through the descriptor.
To use a descriptor you need to do 3 things:
    - Specify a descriptor layout during pipeline creation
    - Allocate a descriptor set from a descriptor pool
    - Bind the descroptor set during rendering

The descritpor layout specifies the resources that are going to be accessed by the pipeline. A descriptor set specifies the actual buffer or image resources that will be bound to the descriptors.

There are many types of descritptors, but we will focus on `Uniform Buffer Objects`

## Descriptor layout and buffer
### Vertex Shader
Firstly, we'll start by defining the uniform object in the vertex shader.
A uniform doens't need in or out flags, because it doesn't matter, it is always available. We define the location using the `binding = x` flag.

We will change the `gl_Position` item to multiply the matrix by the rest of the model and then the position of the item.

In the last vec4 we will have 1.0 in the end to specify that the projection is `perspective division`.

### Descriptor set layout
Create the `uniform buffer object` locally, the Matrix4 needs to be binary compatible with the mat4 tha the shader is using.

Next we will need to describe the item that we will be sending to the GPU. To do that we will create `DescriptorSetLayoutBindings` with the following parameters
    - binding: the location where the buffer is going to be
    - descriptorType: The type of item that we will send
    - count: the number of values in the array
    - stageFlags: which shader this is going to go
    - ImmutableFlags: Used for sampling related descritptors

Next, we need to create a `DescriptorSetLayout` using the binding we just created.
In my solution, I will encapsulate the above functiontlity in the `DescSetLayout`

Lastly, when we create the piepliene we need to specify that we want to add the new descritpor, along the other 2.
### Uniform buffer
To use the data in the shader, we will need to move them into a buffer. We won't need to create a staging buffer as we will move data on every frame (If we did that then the perfomance would degrade).

We need to have multiple buffers as we would have multiple frame in flight as the same time. Also, we don't want to update the the buffer while we are still reading from the previous one. 
We need to have a uniform buffer per swapchain image and we need to update the uniform buffer with the new rotation of the camera, and the perspective and the orientation.
Once we have updated the Camera object, we will need to update the uniform buffers for the frame we are drawing. To do that we use the existing function in the uniform buffer called `update_data` which updates the data of the buffer.

### Updating uniform data
We create a new function to include the camera's updating. I have coded in the cameraState a function to update the 3 properties of the ubo individually or to reset the camera state completely.

For now we will use the `update_model` function and add a matrix with the needed rotation we want to apply in this frame.
At the end, we will use the `update buffer` function, which will update the buffer in the GPU. I have separated this from the `update_model` because we might do a number of separate updates in the ubo before we want to copy the data to the buffer. We need to remember to explicitly update the buffer after we have update the ubo.

## Descriptor pool and sets
In order to send the uniform data we need to describe the data.

### Descriptor pool
Descriptor sets can't be created directly, they must be allocated from a pool like command buffers

With this descriptor pool, we will se tthe type to be Uniform buffer because that's how we'll send it.

### Descriptor set
Now that we've create the pull we'll need to create the sets.

### Using descriptor sets
To use the set we'll need to bind them during the update frame process.

### Multiple descriptor sets
Because we have multiple descriptor sets we need to correctly assign the sets and bindings.
I have set the camera to have set 0, the frag texture and sampler are on set 1 and the cole in set 2. If that wasn't the case the data would be mixed.