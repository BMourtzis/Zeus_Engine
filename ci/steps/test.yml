parameters:
  projects: ['zeus_core', 'zeus_render']

steps:
  # Install suity tool
  - script: cargo install cargo-suity
    displayName: Install cargo suity

  # Run tests for root
  - script: cargo suity
    displayName: Run root tests

  # Publish tests for Root
  - task: PublishTestResults@2
    displayName: "Publish Root tests"
    inputs: 
      testResultsFormat: 'JUnit'
      testResultsFiles: './test-results/default.xml'

  # Run tests for each sub-project
  - ${{ each project in parameters.projects}}:
    - script: |
        cd ${{ project }}
        cargo suity
        cd ..
      displayName: "Run ${{ project }} Tests"
    - task: PublishTestResults@2
      displayName: "Publish ${{ project }} tests"
      inputs: 
        testResultsFormat: 'JUnit'
        testResultsFiles: './${{ project }}/test-results/default.xml'